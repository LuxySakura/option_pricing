# option_pricing
Option Pricing Project for ShinnyTech

## TODO 
- [ ] 学习 Black-Scholes 模型
- [x] Python虚拟环境中初始化项目
- [x] API 设计数据结构
- [x] 前端UI/UX设计
- [x] 依赖描述文件
- [x] 自动化测试文件
- [x] **`README.md` 文档:**
    - **环境设置:** 清晰说明如何配置本地环境、安装依赖.
    - **运行指南:** 清晰说明如何运行你的程序和自动化测试.
    - **设计思路 (重要):** 介绍你的设计决策, 例如为什么选择某个数据结构, 如何组织代码以方便未来扩展等.
    - **假设与取舍 (加分项):** 如果你对需求做了任何假设, 或者在实现中做了某些权衡 (如性能与可读性), 请在此说明.
- [ ] 代码格式规范

## 环境设置

### Python虚拟环境

本项目使用Python虚拟环境来管理依赖，避免包冲突。以下是设置步骤：

#### 1. 创建虚拟环境

虚拟环境已经创建在项目根目录下的`venv`文件夹中。如果需要重新创建，可以执行：

```bash
# 在项目根目录下执行
python -m venv venv
```

#### 2. 激活虚拟环境

**Windows系统：**

```bash
# CMD命令行
venv\Scripts\activate.bat

# PowerShell
venv\Scripts\Activate.ps1
```

**Linux/macOS系统：**

```bash
source venv/bin/activate
```

激活后，命令行前面会出现`(venv)`前缀，表示当前已在虚拟环境中。

#### 3. 安装依赖

```bash
pip install -r requirements.txt
```

#### 4. 退出虚拟环境

完成工作后，可以通过以下命令退出虚拟环境：

```bash
deactivate
```

## 运行指南

#### 一键启动
本项目还创建了`start_dev.bat`脚本，以实现一键启动前后端服务
```bash
start_dev.bat
```

### 后端API服务

1. 确保已激活虚拟环境（见上方"激活虚拟环境"步骤）

2. 启动FastAPI服务：

```bash
# 在项目根目录下执行
uvicorn app.main:app --reload
```

服务将在 http://127.0.0.1:8000 上运行

3. 访问API文档：
   - Swagger UI: http://127.0.0.1:8000/docs
   - ReDoc: http://127.0.0.1:8000/redoc

### 前端应用

#### React前端应用

项目还提供了基于React的现代化前端实现：

1. 安装Node.js依赖：

```bash
# 在frontend/react-app目录下执行
npm install
```

2. 启动开发服务器：

```bash
# 在frontend/react-app目录下执行
npm start
```

应用将在 http://localhost:3000 上运行，并自动代理API请求到后端服务。

3. 构建生产版本：

```bash
# 在frontend/react-app目录下执行
npm run build
```

详细说明请参考 `frontend/react-app/README.md` 文件。

### 运行测试

```bash
# 在项目根目录下执行
python -m pytest
```

## 设计思路
数据结构/代码组织 .etc

### 前端计算器界面
Front-End Computation
（基于React实现）
- 表单式组件 -> 获取用户要计算期权所需数据
    

- 提交按钮 -> 根据用户提交数据，调用后端API计算定价
- 价格显示组件 -> 显示计算后的结果
- 错误信息提示组件 -> 提示可能出现的错误信息

### 后端定价API
（基于FastAPI实现）
- RESTful API 服务
    - 实现Black-Scholes期权定价模型的核心定价逻辑
        - **看涨期权定价公式**
        - **看跌期权定价公式**
    - Black-Scholes期权定价模型涉及的数据变量
        - 期权方向：看涨(Call)/看跌(Put)
            - 是否必填：是
            - 数据类型：Boolean
                - True -> Call
                - False -> Put
        - 标的资产当前市场价格 **(Spot Price)**
            - 是否必填：是
            - 数据类型：Float（保留小数点后两位）
            - 取值范围：> 0
        - 行权价格 **(Strike Price)**
            - 是否必填：是
            - 期权合约中规定的，未来可以用来买入（看涨）或卖出（看跌）标的资产的价格。它是衡量期权是价内、价外还是平价的关键基准。
            - 数据类型：Float（保留小数点后两位）
            - 取值范围：> 0
        - 期权剩余到期时间 **T-t (Time to Maturity)**
            - 是否必填：否（用户输入到期时间和当前时间，系统自行计算）
            - 通常以年为单位，例如，一个3个月后到期的期权，其(T-t)就是0.25年。
            - 数据类型：Float（保留小数点后 n 位数）
            - 取值范围：>= 0
        - 无风险利率 **r (Risk-Free Interst Rate)**
            - 指与期权期限相匹配的国债利率，代表了资金的时间价值
            - 被用来将未来的现金流（行权价格K）折现到当前价值
            - 数据类型：Float
            - 取值范围：负无穷 -> 正无穷
        - 波动率 **σ (Volatility)**
            - 描述资产价格变动的程度，衡量资产价格在未来不确定性的大小
            - 模型中**唯一一个无法直接从市场观察到的参数**
            - 估计方法
                - 历史波动率：根据历史价格估算
                - 隐含波动率：从现有期权价格中反推
            - 数据类型：Float
            - 取值范围：> 0
        - N(d)
            - 标准正态分布的累计分布函数(CDF)，计算一个变量小于或等于d的概率。
    - 计算标准欧式期权的Call & Put价格
- API 接口设计
    - Endpoint
    - 数据格式
- 鲁棒性处理
    - 处理无效参数
        - 价格为负数
        - 时间为负数
    - 返回错误信息

#### API 测试用例设计
- 正常测试用例
    - 输入：看涨期权，S=100，K=95，T=0.5，r=0.05，σ=0.2
    - 输出：预期的看涨期权价格
- 边界测试用例
    - 输入：S=0，K=100，T=1，r=0，σ=1
    - 输出：预期的期权价格，考虑到边界情况（如资产价格为0或无限大）
    - 输入：S=100，K=0，T=1，r=0，σ=1
    - 输出：预期的期权价格，考虑到边界情况（如资产价格为0或无限大）
- 异常测试用例
    - 异常情况 1：期权剩余到期时间 < 0
        - 输入：S=-10，K=95，T=0.5，r=0.05，σ=0.2
        - 输出：预期的错误信息，解释输入的无效数据
    - 异常情况 2：当前标的资产价格 < 0
        - 输入：S=-10，K=95，T=0.5，r=0.05，σ=0.2
        - 输出：预期的错误信息，解释输入的无效数据
    - 异常情况 3：行权价格 < 0
        - 输入：S=10，K=-95，T=0.5，r=0.05，σ=0.2
        - 输出：预期的错误信息，解释输入的无效数据
    - 异常情况 4：波动率 <= 0
        - 输入：S=10，K=-95，T=0.5，r=0.05，σ=0.2
        - 输出：预期的错误信息，解释输入的无效数据

## 假设/取舍
- Black-Scholes期权定价模型涉及的假设
    - 标的资产价格服从几何布朗运动，波动率恒定
    - 无风险利率已知且恒定
    - **无股息支付**：期权有效期内，标的股票不支付股息
    - **期权类型**：欧式期权